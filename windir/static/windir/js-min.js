const disabled=new Set;async function getData(e,n="GET",t=null,o=!0){var r={"X-Requested-With":"XMLHttpRequest"},o=t&&o?JSON.stringify(t):t;"GET"!==n&&(r["X-CSRFToken"]=document.querySelector('input[name="csrfmiddlewaretoken"]').value);try{return await fetch(e,{method:n,headers:r,body:o}).then(e=>e.json())}catch{return{error:"Проблема с интернет-подключением"}}}function addCookie(e,n){document.cookie=e+`=${n}; expires=Thu, 19 Sep 2030 12:00:00 UTC; Path=/`}function deleteCookie(e){document.cookie=e+"=; Expires=Thu, 01 Jan 1970 00:00:01 GMT; Path=/"}function getCookie(n){return decodeURIComponent(document.cookie).split("; ").find(e=>e.startsWith(n))?.split("=")[1]}async function login(){var e,n=event.target,t=event.target.form;let o=n.disabled=!0;for(const r of t.elements)r.checkValidity()||(markRed(r),o=!1);o&&("success"in(e=await getData("/login/","POST",new FormData(t),!1))?location.reload(!0):"error"in e?t.querySelector(".error-msg").innerHTML=e.error:"user-error"in e?(t.querySelector(".error-msg").innerHTML=e["user-error"],markRed(t.username),markRed(t.password)):(t.querySelector(".error-msg").innerHTML="Произошла ошибка, свяжитесь с администратором",console.log(e))),n.disabled=!1}async function logout(){var e=await getData("/logout/");"error"in e?document.querySelector(".error-msg").innerHTML=e.error:window.location.reload(!0)}function openNav(){const e=document.querySelector("nav"),n=document.querySelector("#nav-links");e.classList.contains("nav-open")||(event.stopPropagation(),e.classList.add("nav-open"),n.classList.add("open-nav"),n.addEventListener("animationend",()=>{n.classList.remove("open-nav")},{once:!0}),document.addEventListener("click",()=>{n.classList.add("close-nav"),n.addEventListener("animationend",()=>{n.classList.remove("close-nav"),e.classList.remove("nav-open")},{once:!0})},{once:!0}))}function toggleNavBar(){var e=document.querySelector("nav"),n=document.querySelector("#content");700<window.innerWidth?n.scrollTop>n.querySelector("header").offsetHeight-e.offsetHeight?(e.classList.replace("nav-white","nav-black"),e.querySelector("#nav-up-btn").classList.remove("hidden"),e.querySelector("#nav-theme-btn").classList.remove("hidden")):(e.classList.replace("nav-black","nav-white"),e.querySelector("#nav-up-btn").classList.add("hidden"),e.querySelector("#nav-theme-btn").classList.add("hidden")):(e.classList.replace("nav-white","nav-black"),n.scrollTop>.7*document.querySelector("header").offsetHeight?(e.querySelector("#nav-up-btn").classList.remove("hidden"),e.querySelector("#nav-theme-btn").classList.remove("hidden")):(e.querySelector("#nav-up-btn").classList.add("hidden"),e.querySelector("#nav-theme-btn").classList.add("hidden")))}function scrollUp(){document.querySelector("#content").scrollTo({top:0,behavior:"smooth"})}function agreeToCookies(){addCookie("agree","y");const e=document.getElementById("cookie-agreement");e.classList.add("fade-out"),e.addEventListener("animationend",()=>{e.classList.remove("fade-out"),e.classList.add("hidden")},{once:!0})}function switchTheme(){document.querySelector("main").classList.toggle("dark")?addCookie("dark","y"):deleteCookie("dark")}function checkCookies(){getCookie("dark")&&document.querySelector("main")?.classList.add("dark"),getCookie("agree")||document.querySelector("#cookie-agreement").classList.remove("hidden")}function scrollDown(){document.querySelector("main")&&(document.querySelector("#content").scrollTo({top:document.querySelector("main").offsetTop,behavior:"smooth"}),document.querySelector("#content").addEventListener("scroll",toggleNavBar)),window.innerHeight>window.innerWidth&&document.querySelector("nav").classList.replace("nav-white","nav-black")}function hideRed(e){e.classList.remove("invalid")}function markRed(e,n=null){e.classList.add("invalid"),e.nextElementSibling?.classList.contains("form-error")&&(e.nextElementSibling.innerHTML=n?n.join(" "):"Обязательное поле")}function check_login_format(){var e=event.target;e.value&&!/^[A-Za-z0-9-_]+$/.test(e.value)?markRed(e,"Допустимые сиволы: A-Z a-z 0-9 _ -"):hideRed(e)}function check_confirm(e,n){e=document.getElementById(e),n=document.getElementById(n);return e.value===n.value?(hideRed(n),!0):"input"!==event.type?(markRed(n,["Пароли не совпадают"]),!1):void 0}function switchContact(){var e=document.querySelector("#contact");event.target.checked?(e.type="text",document.getElementById("contact-label").innerHTML="Никнейм"):(e.type="email",document.getElementById("contact-label").innerHTML="Электронная почта"),e.value="",e.focus()}function showOtherProjects(){document.querySelector(".other-proj").classList.toggle("none")}async function openProfile(){document.querySelector("#profile-form-div").classList.toggle("hidden");var e=document.querySelector(".profile-form select"),n=await getData("/changezone");for(const o of n.timezones){var t=document.createElement("option");t.value=o,t.innerHTML=o,t.selected=o===n.selected,e.append(t)}}async function register(){var e,n=event.target,t=event.target.form;n.disabled=!0;let o=check_confirm("reg-password","confirm");for(const r of t.elements)r.checkValidity()||(markRed(r),o=!1);o?"success"in(e=await getData("/register/","POST",new FormData(t),!1))?(document.querySelector("main").innerHTML="<h3>Заявка отправлена</h3>",document.querySelector("main").scrollIntoView({behavior:"smooth"})):"errors"in e?markFormInvalid(t,errors=e.errors):markFormInvalid(t,msg="Произошла ошибка. Повторите позже."):markFormInvalid(t),n.disabled=!1}function markFormInvalid(e,n=null,t=null){if(n)for(var o in n)markRed(e[o],n[o]);e.querySelector(".error-msg").innerHTML=t||"Не все поля заполнены верно",document.querySelector("main").scrollIntoView({behavior:"smooth"})}async function changePass(){var e,n=event.target.form,t=document.querySelector(".profile-div .error-msg");t.innerHTML="";let o=check_confirm("new_pwd","new_confirm");for(const r of n.elements)r.checkValidity()||(markRed(r),o=!1);o&&("success"in(e=await getData("/changepass/","POST",new FormData(n),!1))?(t.innerHTML=e.success,t.classList.add("green")):(t.classList.remove("green"),"old_password"in e?(t.innerHTML=e.old_password.join(" "),markRed(n.old_password),t.classList.remove("green")):"new_password2"in e&&(t.innerHTML=e.new_password2.join(" "),t.classList.remove("green"))))}async function changeZone(){var e=event.target.form,n=document.querySelector(".profile-div .error-msg"),e=(n.innerHTML="",await getData("/changezone/","POST",{utc:e.utc.value}));"success"in e?(n.innerHTML=e.success,n.classList.add("green")):(n.innerHTML="Произошла ошибка",n.classList.remove("green"))}window.addEventListener("load",()=>{checkCookies(),scrollDown(),document.querySelectorAll("form").forEach(e=>{e.querySelectorAll(".input").forEach(e=>e.addEventListener("focus",()=>hideRed(e)))})});